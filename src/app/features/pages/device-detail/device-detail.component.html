<div class="min-h-screen bg-gray-50 p-4 md:p-6">
  <div class="w-11/12 mx-auto">
    <div class="my-2 md:w-1/4 rounded-xl shadow-sm border border-gray-100">
      <p-breadcrumb [model]="breadCrumbItem()" [home]="home">
        <ng-template #separator> / </ng-template>
      </p-breadcrumb>
      <p-message severity="info">
        <h3 class="text-xl">As On</h3>

        @let timestamp = deviceData.data()?.[0]?.timestamp;

        <span>
          {{
            timestamp ? (timestamp | date : "mediumDate") : "No data available"
          }}
        </span>
      </p-message>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <div class="lg:col-span-4 xl:col-span-3 space-y-6">
        @if (deviceData.isLoading()) {
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <div class="flex flex-col justify-center items-center py-8">
            <p-progress-spinner
              strokeWidth="4"
              fill="transparent"
              animationDuration=".5s"
              ariaLabel="Loading Zen Stats"
            />
            <span class="mt-4 text-gray-600 text-sm">Loading Zen Stats</span>
          </div>
        </div>
        } @else if (deviceData.isError()) {
        <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
          <div class="flex flex-col justify-center items-center py-8">
            <p-message severity="error" class="mb-4">
              Error loading data
            </p-message>
            <p-button
              size="small"
              icon="pi pi-refresh"
              label="Reload"
              severity="danger"
              (onClick)="refreshData()"
            ></p-button>
          </div>
        </div>
        } @else {

        <div
          class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow duration-200 space-y-5"
        >
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Exporter</h3>

          <p-divider type="dashed" />

          <div class="space-y-3">
            <div class="flex flex-col gap-3">
              <div class="flex flex-col space-y-1">
                <span class="text-xs text-gray-500">Start </span>
                <p-datepicker
                  [(ngModel)]="start"
                  placeholder="Start"
                  [showTime]="true"
                  [hourFormat]="'24'"
                  class="w-full"
                  size="small"
                  [showClear]="true"
                ></p-datepicker>
              </div>

              <div class="flex flex-col space-y-1">
                <span class="text-xs text-gray-500">End </span>
                <p-datepicker
                  [(ngModel)]="end"
                  [showTime]="true"
                  [hourFormat]="'24'"
                  placeholder="End"
                  class="w-full"
                  size="small"
                  [showClear]="true"
                ></p-datepicker>
              </div>

              <button
                pButton
                label="Export Data"
                icon="pi pi-download"
                class="w-full"
                (click)="exportData()"
                [loading]="loading()"
              ></button>

              @if (emptyFilters()) {
              <p-message severity="error" class="text-sm"
                >Please select start and end date/time for export.</p-message
              >
              }
            </div>
          </div>
        </div>

        }
      </div>

      <div class="lg:col-span-8 xl:col-span-9">
        <div
          class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 hover:shadow-md transition-shadow duration-200 min-h-[500px] relative"
        >
          <canvas id="deviceChart"></canvas>

          @if (deviceData.isLoading()) {
          <div
            class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-xl"
          >
            <div class="text-center">
              <p-progress-spinner
                strokeWidth="4"
                fill="transparent"
                animationDuration=".5s"
              />
              <p class="mt-4 text-gray-600">Loading chart data...</p>
            </div>
          </div>
          } @else if (deviceData.isError()) {
          <div
            class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-xl"
          >
            <div class="text-center">
              <p-message severity="error">Failed to load chart data</p-message>
            </div>
          </div>
          } @else if (!deviceData.data()?.length) {
          <div
            class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-xl"
          >
            <div class="text-center text-gray-500">
              <app-empty-state (reload)="refreshData()" />
            </div>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
</div>
<p-toast />
